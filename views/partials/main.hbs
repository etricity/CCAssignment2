<h1 id = 'greeting'></h1>

<form id = 'form'>
    <input id = song-name type = "text"/>
    <button type = submit> Search</button>
    
    <p id = song-data></p>
</form>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>
    
    var params = getHashParams();
    var access_token = params.access_token,
        refresh_token = params.refresh_token;
    
    //Utility Function
     function getHashParams() {
          var hashParams = {};
          var e, r = /([^&;=]+)=?([^&;]*)/g,
              q = window.location.hash.substring(1);
          while ( e = r.exec(q)) {
             hashParams[e[1]] = decodeURIComponent(e[2]);
          }
          return hashParams;
        }
    
    //Onload
    window.onload = () => {
        
        $.ajax({
                url: 'https://api.spotify.com/v1/me',
                headers: {
                  'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                    console.log(response);
                   document.getElementById("greeting").innerText = response.display_name;
                }
            });        
    }

</script>

<script>
    //Submitting form
//   $('document').ready(function(){
//       $('#form').on('submit', function (ev) {
//            ev.preventDefault();
//           console.log(params);
//           
//           var baseURL = 'https://api.spotify.com/v1/search';
//           baseURL += '?q=' + document.getElementById("song-name").value + '&type=artist' + '&limit=1';  
//           
//           console.log(baseURL);
//           
//           $.ajax({
//               url: baseURL,
//               headers: {
//                   'Authorization': 'Bearer ' + access_token
//               },
//               success: function(response) {
//                   console.log(response);
//                }, 
//               error: function(err) {
//                   console.log(err);
//               }
//            });
//           
//});
//   });
    
       $('document').ready(function(){
       $('#form').on('submit', function (ev) {
            ev.preventDefault();
           
           var data;
           
           $.ajax({
               url: '/spotify/search',
               headers: {
                   'Authorization': 'Bearer ' + access_token
               },
               data: {
                   song_name: document.getElementById("song-name").value, 
                   access_token: access_token
               },
               success: success, 
               error: error
            });
           
           function success(data) {
               console.log(data);
               document.getElementById("song-data").innerText = 'This song was created by ' + data.tracks.items[0].artists[0].name;
}
           function error(error) {
}
           
});
   });
    
    
</script>
