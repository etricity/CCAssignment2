<!doctype html>

<!--Main document for the Page. Other handlebar files are passed to this for dynamic html-->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<nav>
  <div class='full-content'> <p> S.P.A.D.E</p> </div>
  <div class = 'bottom-content'>
    <a href="https://www.spotify.com/au/"> Go To Spotify</a>
  </div>
</nav>
<body>
<!--    Handlebar stuff-->
  <div id='title'>
<h1 id = 'greeting'></h1>
</div>

<div id= 'table-div'>
  <table id='user-Table'>
    <tr>
      <td>Name </td>
      <td id='name'></td>
    </tr>
    <tr>
      <td>Country</td>
      <td id='country'></td>
    </tr>
    <tr>
      <td>Email</td>
      <td id='email'></td>
    </tr>
    <tr>
      <td>Product</td>
      <td id='product'></td>
    </tr>
  </table>
</div>


<div class ="full-content">
  <form id = 'form'>
    <p>Search For A Song</p>
      <input id = 'song-name' type = "text"/>
      <button type = submit> Search</button>
  </form>
</div>




<footer> S.P.A.D.E &COPY; </footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

<script>
  window.onload = () => {
    var params = getHashParams();
    console.log(params);
    var access_token = params.access_token,
    refresh_token = params.refresh_token;

    $.ajax({
      url: 'https://api.spotify.com/v1/me',
      headers: {
        'Authorization': 'Bearer ' + access_token
      },
      success: function(response) {
        console.log(response);
        paintPage(response);
      }
    });
  }

  function getHashParams() {
    var hashParams = {};
    var e, r = /([^&;=]+)=?([^&;]*)/g,
    q = window.location.hash.substring(1);
    while ( e = r.exec(q)) {
      hashParams[e[1]] = decodeURIComponent(e[2]);
    }
    return hashParams;
  }

  function paintPage(response){
    document.getElementById("greeting").innerText = response.display_name;
    document.getElementById("name").innerText = response.display_name;
    document.getElementById("email").innerText = response.email;
    document.getElementById("country").innerText = response.country;
    document.getElementById("product").innerText = response.product;



  }

</script>
</body>
</html>

